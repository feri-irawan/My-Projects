<!doctype html>
<html lang="en">
<head>

 <!--  
 Hai, selamat datang di proyek "Cari Kode Pos",
 --------------------
 Author : Feri Irawan
 Github : https://github.com/feri-irawan
 Email  : feriirawans1998@gmail.com
  -->
  
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-eOJMYsd53ii+scO/bJGFsiCZc+5NDVN2yr8+0RDqr0Ql0h+rP48ckxlpbzKgwra6" crossorigin="anonymous">
  <link rel="stylesheet" href="style.css">
  
  <title>Kode Pos Indonesia</title>
</head>
<body>

  <div class="container p-3">

    <!-- PETUNUK -->
    <div class="modal fade" id="staticBackdrop" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="staticBackdropLabel" aria-hidden="true">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="staticBackdropLabel">Petunjuk Penggunaan</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            Untuk mencari kode pos,<br>
            Anda dapat menuliskan salah satu nama:
            <br>
            <br>
            <ul>
              <li>Propinsi</li>
              <li>Kota/Kabupaten</li>
              <li>Kecamatan</li>
              <li>Desa</li>
            </ul>
            Di kolom pencarian
            <br>
            <br>
            Untuk memastikan kode pos <b>benar</b> atau <b>salah</b>, Anda juga dapat langsung menuliskan <b>kode pos</b> pada kolom pencarian.
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-primary" data-bs-dismiss="modal">Mengerti</button>
          </div>
        </div>
      </div>
    </div>


    <!-- FORM SEARCH -->
    <form>
      <div class="input-group mb-3">
        <button type="button" class="btn btn-secondary" data-bs-toggle="modal" data-bs-target="#staticBackdrop">
          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-info-circle" viewBox="0 0 16 16">
            <path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14zm0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16z"/>
            <path d="m8.93 6.588-2.29.287-.082.38.45.083c.294.07.352.176.288.469l-.738 3.468c-.194.897.105 1.319.808 1.319.545 0 1.178-.252 1.465-.598l.088-.416c-.2.176-.492.246-.686.246-.275 0-.375-.193-.304-.533L8.93 6.588zM9 4.5a1 1 0 1 1-2 0 1 1 0 0 1 2 0z"/>
          </svg>
        </button>
        <input type="search" name="q" class="form-control" placeholder="Cari..." required autofocus />
        <button id="btn-search" type="submit" class="btn btn-primary">
          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-search" viewBox="0 0 16 16">
            <path d="M11.742 10.344a6.5 6.5 0 1 0-1.397 1.398h-.001c.03.04.062.078.098.115l3.85 3.85a1 1 0 0 0 1.415-1.414l-3.85-3.85a1.007 1.007 0 0 0-.115-.1zM12 6.5a5.5 5.5 0 1 1-11 0 5.5 5.5 0 0 1 11 0z"/>
          </svg>
        </button>
      </div>
    </form>
    
    <div id="hasil"></div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta3/dist/js/bootstrap.bundle.min.js" integrity="sha384-JEW9xMcG8R+pH31jmWH6WWP0WintQrMb4s7ZOdauHnUtxwoG2vI5DkLtS3qm9Ekf" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" type="text/javascript" charset="utf-8"></script>
  <script>
    // Jalankan function getKodePos() jika form di submit
    $("form").bind("submit", function (event) {
      getKodePos()
    });
    
    // Jalankan function getKodePos() jika keyboard telah ditekan
    $("[name=q]").on("keyup", function (event) {
      getKodePos()
    });
    
    // Function getKodePos()
    function getKodePos() {
      let inputSearch = $("[name=q]");
      let btnSearch = $("#btn-search");
      let container = $("#hasil");
      
      
      // Mengganti icon search ke icon loading pada tombol
      btnSearch.html(`
      <center>
        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-arrow-clockwise spin" viewBox="0 0 16 16">
          <path fill-rule="evenodd" d="M8 3a5 5 0 1 0 4.546 2.914.5.5 0 0 1 .908-.417A6 6 0 1 1 8 2v1z"/>
          <path d="M8 4.466V.534a.25.25 0 0 1 .41-.192l2.36 1.966c.12.1.12.284 0 .384L8.41 4.658A.25.25 0 0 1 8 4.466z"/>
        </svg>
      </center>
      `);
      
      // Memulai ajax untuk mendapatkan data
      $.ajax({
        url: "https://kodepos.vercel.app/search",
        type: "get",
        dataType: "json",
        data: inputSearch.serialize(),
        success: function (hasil) {
          
          // Mereset icon tombol pencarian dan isi container
          container.html("");
          btnSearch.html(`
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-search" viewBox="0 0 16 16">
              <path d="M11.742 10.344a6.5 6.5 0 1 0-1.397 1.398h-.001c.03.04.062.078.098.115l3.85 3.85a1 1 0 0 0 1.415-1.414l-3.85-3.85a1.007 1.007 0 0 0-.115-.1zM12 6.5a5.5 5.5 0 1 1-11 0 5.5 5.5 0 0 1 11 0z"/>
            </svg>
          `);
          
          // Menyimpan data ke variabel
          let data = hasil.data;
          console.log("Success search: " + inputSearch.val());
          
          // Melakukan pengulangan data untuk ditampilkan
          $.each(data, function (i, data) {
              container.append(`
              <div class="card mb-3 shadow">
                <div class="card-header bg-primary"> No. `+(i+1)+`</div>
                <div class="card-body">
                  <table class="table">
                    <tr>
                      <td width="50%">Propinsi</td>
                      <td>`+data.province+`</td>
                    </tr>
                    <tr>
                      <td>Kota/Kab.</td>
                      <td>`+data.city+`</td>
                    </tr>
                    <tr>
                      <td>Kecamatan</td>
                      <td>`+data.subdistrict+`</td>
                    </tr>
                    <tr>
                      <td>Kelurahan</td>
                      <td>`+data.urban+`</td>
                    </tr>
                    <tr>
                      <td>Kode pos</td>
                      <td>`+data.postalcode+`</td>
                    </tr>
                  </table>
                </div>
              </div>
              `);
          });
        }
      });
      
      event.preventDefault();
    }
  </script>
</body>
</html>
