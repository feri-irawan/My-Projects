<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>Document</title>
  
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-eOJMYsd53ii+scO/bJGFsiCZc+5NDVN2yr8+0RDqr0Ql0h+rP48ckxlpbzKgwra6" crossorigin="anonymous">
  <link rel="stylesheet" href="alquran-online/res/style.css" type="text/css" media="all" />
</head>
<body>


<div class="container p-3">
  <button id="font-size-plus">T+</button>
  <button id="font-size-minus">T-</button>
  <div class="row" id="quran"></div>
</div>

<footer class="text-center p-3">
  Made with &hearts; by <a class="text-decoration-none" href="https://feri-irawan.netlify.app">Feri Irawan</a>
</footer>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta3/dist/js/bootstrap.bundle.min.js" integrity="sha384-JEW9xMcG8R+pH31jmWH6WWP0WintQrMb4s7ZOdauHnUtxwoG2vI5DkLtS3qm9Ekf" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" type="text/javascript" charset="utf-8"></script>
<script>
var   container = $("#quran");
const host      = "https://api.quran.sutanlab.id",
      listSurah = "/surah/",
      isiSurah  = "?surah=",
      noSurah   = getParam("surah"),
      ayat      = getParam("ayat");
      
if (checkParam("surah") === true) {
  getSurah()
} else {
  getListSurah()
}


// get list surat
function getListSurah() {
  $.ajax({
    url: host + listSurah,
    typeData: "json",
    success: (hasil) => {
      console.log("List Success!")
      console.log(hasil)
      $.each(hasil.data, (i, list) => {
        var name = list.name;
        container.append(`
        <div class="col-md-6">
          <a href="?surah=`+list.number+`">
            <div class="card mb-3">
              <div class="card-header">
              <small>Surah: `+list.number+`, Ayat: `+list.numberOfVerses+`</small>
              </div>
              <div class="card-body">
                <div class="row align-items-center">
                  <div class="col-6">
                    <h5>`+name.transliteration.id+`</h5>
                    <small class="text-muted">`+name.translation.id+`</small>
                  </div>
                  <div class="col-6 text-end text-arab"><h1>`+name.short+`</h1></div>
                </div>
              </div>
            </div>
          </a>
        </div>
        `)
      })
      
      // font size
      fontSize()
    },
    error: () => {
      console.log("List Error!")
    }
  })
}

// get surah
function getSurah() {
  $.ajax({
    url: host + listSurah + noSurah,
    typeData: "json",
    success: (hasil) => {
      console.log("Success surah!");
      console.log(hasil);
      
      var surah = hasil.data,
          name  = surah.name,
          relevation = surah.relevation,
          preBismillah = surah.preBismillah,
          tafsir = surah.tafsir.id,
          verses = surah.verses;
      
      // judul
      container.append(`
        <div class="text-center">
        <h3 class="text-arab">`+name.short+`</h3>
        <h5>`+name.transliteration.id+`</h5>
        <h6>`+name.translation.id+`</h6>
        </div>
      `);
      
      // bismillah
      if (preBismillah !== null) {
        var bismillahArab = preBismillah.text.arab,
            bismillahLatin = preBismillah.text.transliteration.en,
            bismillahId = preBismillah.translation.id;
        container.append(`
          <div class="text-center mb-3">
            <h2 class="text-arab">`+bismillahArab+`</h2>
            <div class="text-muted">`+bismillahLatin+`</div>
            <div class="text-primary">`+bismillahId+`</div>
          </div>
        `)
      }
      
      // ayat-ayat
      $.each(verses, (i, verse) => {
        var verseNumber = verse.number.inSurah,
            // text
            text = verse.text,
            textArab = text.arab,
            textLatin = text.transliteration.en,
            textId = verse.translation.id;
        
        container.append(`
          <div class="ayat-container">
            <div class="row mb-3">
              <div class="col-3">`+verseNumber+`</div>
              <div class="col-9 text-arab text-end"><h2>`+textArab+`</h2></div>
            </div>
            <div class="p-3">
              <div class="text-muted">`+textLatin+`</div>
              <div class="text-primary">`+textId+`</div>
            </div>
          </div>
        `)
      })
      
      // font size
      fontSize();
    },
    error: () => {
      console.log("Error surah!");
    }
  });
}


// get and check url params
function checkParam(param) {
  let searchParams = new URLSearchParams(window.location.search);
  return searchParams.has(param);
}
function getParam(param) {
  let searchParams = new URLSearchParams(window.location.search);
  return searchParams.get(param);
}

// font size
function increaseFontSize(target, increaseFactor){
     txt = document.querySelector(target);
     style = window.getComputedStyle(txt, null).getPropertyValue('font-size');
     currentSize = parseFloat(style);
     txt.style.fontSize = (currentSize + increaseFactor) + 'px';
}
function fontSize() {
  $("#font-size-plus").on("click", () => {
    increaseFactor(".text-arab", 1)
  })
  $("#font-size-minus").on("click", () => {
    increaseFactor(".text-arab", -1)
  })
}
</script>
</body>
</html>
